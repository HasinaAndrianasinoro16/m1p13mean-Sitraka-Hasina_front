<div class="row">
  <div class="col-md-12">
    <div class="card">

      <!-- HEADER -->
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <h5 class="card-title mb-1">Gestion des produits</h5>
          <p class="card-category mb-0">
            Gérez vos produits et leur stock
          </p>
        </div>

        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#addProductModal">
          <i class="nc-icon nc-simple-add"></i> Nouveau produit
        </button>
      </div>

      <!-- TABLE -->
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="text-primary">
            <tr>
              <th>Produit</th>
              <th>Prix unitaire</th>
              <th>Stock</th>
              <th class="text-end">Action</th>
            </tr>
            </thead>

            <tbody>
            <tr *ngFor="let p of produitsPaginees">
              <td>{{ p.nom }}</td>
              <td>{{ p.prix | number }} Ar</td>
              <td>{{ p.stock }}</td>
              <td class="text-end">
                <button
                  class="btn btn-sm btn-outline-success"
                  data-bs-toggle="modal"
                  data-bs-target="#addStockModal"
                  (click)="ouvrirAjoutStock(p)">
                  <i class="nc-icon nc-box"></i> Ajouter stock
                </button>
              </td>
            </tr>

            <tr *ngIf="produits.length === 0">
              <td colspan="4" class="text-center text-muted py-4">
                Aucun produit enregistré
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- PAGINATION -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-end">

            <li class="page-item" [class.disabled]="pageActuelle === 1">
              <a class="page-link" (click)="changerPage(pageActuelle - 1)">
                Précédent
              </a>
            </li>

            <li
              class="page-item"
              *ngFor="let _ of [].constructor(totalPages); let i = index"
              [class.active]="pageActuelle === i + 1"
            >
              <a class="page-link" (click)="changerPage(i + 1)">
                {{ i + 1 }}
              </a>
            </li>

            <li class="page-item" [class.disabled]="pageActuelle === totalPages">
              <a class="page-link" (click)="changerPage(pageActuelle + 1)">
                Suivant
              </a>
            </li>

          </ul>
        </nav>

      </div>
    </div>
  </div>
</div>

<!-- MODAL : NOUVEAU PRODUIT -->
<div class="modal fade" id="addProductModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Nouveau produit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Image</label>
          <input type="file" class="form-control" accept=".jpg, .png, .jpeg" [(ngModel)]="nouveauProduit.image">
        </div>
        <div class="mb-3">
          <label class="form-label">Nom du produit</label>
          <input class="form-control" [(ngModel)]="nouveauProduit.nom">
        </div>

        <div class="mb-3">
          <label class="form-label">Prix unitaire (Ar)</label>
          <input type="number" class="form-control" [(ngModel)]="nouveauProduit.prix">
        </div>

        <div class="mb-3">
          <label class="form-label">Stock initial</label>
          <input type="number" class="form-control" [(ngModel)]="nouveauProduit.stock">
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button
          class="btn btn-primary"
          data-bs-dismiss="modal"
          (click)="ajouterProduit()">
          Enregistrer
        </button>
      </div>

    </div>
  </div>
</div>

<!-- MODAL : AJOUT STOCK -->
<div class="modal fade" id="addStockModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Ajouter du stock – {{ produitSelectionne?.nom }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <label class="form-label">Quantité à ajouter</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="quantiteAjout">
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button
          class="btn btn-success"
          data-bs-dismiss="modal"
          (click)="ajouterStock()">
          Ajouter
        </button>
      </div>

    </div>
  </div>
</div>
