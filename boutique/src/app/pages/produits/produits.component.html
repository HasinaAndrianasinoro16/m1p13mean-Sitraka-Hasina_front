<div class="row">
  <div class="col-md-12">
    <div class="card">

      <!-- HEADER -->
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <h5 class="card-title mb-1">Gestion des produits</h5>
          <p class="card-category mb-0">
            Gérez vos produits et leur stock
          </p>
        </div>

        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#addProductModal">
          <i class="nc- icon nc-simple-add"></i>
          Nouveau produit
        </button>
      </div>

      <!-- BODY -->
      <div class="card-body">

        <!-- TABLE -->
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="text-primary">
            <tr>
              <th>Image</th>
              <th>Produit</th>
              <th>Prix unitaire</th>
              <th>Stock</th>
              <th class="text-end">Action</th>
            </tr>
            </thead>

            <tbody>

            <!-- AUCUN PRODUIT -->
            <tr *ngIf="produitData.length === 0">
              <td colspan="4" class="text-center text-muted py-4">
                Aucun produit enregistré
              </td>
            </tr>

            <!-- PRODUITS -->
            <tr *ngFor="let p of produitData">
              <td class="text-center align-middle">
                <img
                  [src]="p.imagePrincipaleUrl || 'assets/img/default-product.jpg'"
                  alt="Image produit"
                  class="img-thumbnail"
                  style="width: 60px; height: 60px; object-fit: cover;"
                />
              </td>

              <td>
                <a
                  class="link-info"
                  [routerLink]="['/detail-produit']"
                  [queryParams]="{id: p.id}">
                  {{ p.nom }}
                </a>
              </td>
              <td>{{ p.prix | number }} Ar</td>
              <td>{{ p.stock }}</td>
              <td class="text-end">
                <button
                  (click)="clickInfo(p.id,p.stock)"
                  class="btn btn-sm btn-outline-success"
                  data-bs-toggle="modal"
                  data-bs-target="#addStockModal">
                  <i class="nc-icon nc-box"></i>
                  Ajouter stock
                </button>
              </td>
            </tr>

            </tbody>
          </table>
        </div>

        <!-- PAGINATION -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination justify-content-end">

            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="goToPage(currentPage - 1)">
                Précédent
              </a>
            </li>

            <li
              class="page-item"
              *ngFor="let p of pages"
              [class.active]="currentPage === p">
              <a class="page-link" (click)="goToPage(p)">
                {{ p }}
              </a>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" (click)="goToPage(currentPage + 1)">
                Suivant
              </a>
            </li>

          </ul>
        </nav>

      </div>
    </div>
  </div>
</div>

<!-- ===================== -->
<!-- MODAL : NOUVEAU PRODUIT -->
<!-- ===================== -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Nouveau produit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div class="mb-3">
          <label class="form-label">Nom du produit<span style="color: red" >*</span></label>
          <input type="text" class="form-control" placeholder="Nom du produit" [(ngModel)]="nomProduit">
        </div>

        <div class="mb-3">
          <label class="form-label">
            Catégorie
          </label>

          <select
            class="form-control select-control"
            [(ngModel)]="categorie"
          >
            <option value="" disabled selected>
              -- Sélectionner une catégorie --
            </option>

            <option
              *ngFor="let c of categories"
              [value]="c._id"
            >
              {{ c.nom }}
            </option>
          </select>
        </div>


        <div class="mb-3">
          <label class="form-label">Prix unitaire (Ar)<span style="color: red" >*</span></label>
          <input type="number" class="form-control" placeholder="0" [(ngModel)]="prix" >
        </div>

        <div class="mb-3">
          <label class="form-label">Stock initial<span style="color: red" >*</span></label>
          <input type="number" class="form-control" placeholder="0" [(ngModel)]="stock" >
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea cols="50" rows="4" class="form-control" [(ngModel)]="description" ></textarea>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Annuler
        </button>
        <button class="btn btn-primary" (click)="clickAddProduit()" data-bs-dismiss="modal">
          Enregistrer
        </button>
      </div>

    </div>
  </div>
</div>

<!-- ===================== -->
<!-- MODAL : AJOUT STOCK -->
<!-- ===================== -->
<div class="modal fade" id="addStockModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Ajouter du stock
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <label class="form-label">Quantité à ajouter</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="addStock"
          placeholder="Quantité"
          min="1"
        />
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Annuler
        </button>
        <button class="btn btn-success" data-bs-dismiss="modal" (click)="clickAddStock(selectedId, currentStock)" >
          Ajouter
        </button>
      </div>

    </div>
  </div>
</div>

